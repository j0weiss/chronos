<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chronos</title>
</head>
<body>
<header>
  <h1>Chronos</h1>
</header>
<section>
  <div>
    <label>Timer: </label>
    <span id="timer"></span>
    <button id="start-timer">Start</button>
    <button id="pause-timer">Pause</button>
    <button id="stop-timer">Stop</button>
  </div>
  <div>
    <label>Workout Time: </label>
    <span id="workout-time"></span>
    <button id="increase-workout-time" class="time-adjustment">+ 5s</button>
    <button id="decrease-workout-time" class="time-adjustment">- 5s</button>
  </div>
  <div>
    <label>Rest Time: </label>
    <span id="rest-time"></span>
    <button id="increase-rest-time" class="time-adjustment">+ 5s</button>
    <button id="decrease-rest-time" class="time-adjustment">- 5s</button>
  </div>
  <div>
    <label>Workouts: </label>
    <span id="workouts-number"></span>
    <button id="increase-workouts-number"> + </button>
    <button id="decrease-workouts-number"> - </button>
  </div>
  <div>
    <label>Repetitions: </label>
    <span id="repetitions-number"></span>
    <button id="increase-repetitions-number"> + </button>
    <button id="decrease-repetitions-number"> - </button>
  </div>
</section>
<script>
  // time unit is seconds by default
  const defaultWorkoutTime = 30;
  const defaultRestTime = 10;
  const defaultWorkoutsNumber = 5;
  const defaultRepetitionsNumber = 3;
  const defaultWorkoutTimePerRepetition = defaultWorkoutsNumber * defaultWorkoutTime;
  const defaultRestTimePerRepetition = ( defaultWorkoutsNumber - 1 ) * defaultRestTime;
  const defaultTotalTime = defaultRepetitionsNumber * (defaultWorkoutTimePerRepetition + defaultRestTimePerRepetition);
  const incrementTime = 5;
  let workoutTime = defaultWorkoutTime;
  let restTime = defaultRestTime;
  let totalTime = defaultTotalTime;
  let workoutsNumber = defaultWorkoutsNumber;
  let repetitionsNumber = defaultRepetitionsNumber;
  let timer = null;

  function startTimer() {
    if (!timer) {
      const end = Date.now() + totalTime * 1000;
      timer = setInterval(countdown, 1000, end);
      renderTimeAt(totalTime, '#timer');
    }
  }

  function countdown(endTimePoint) {
    const now = Date.now();
    totalTime = (endTimePoint - now) / 1000;

    if (totalTime <= 0) {
      clearInterval(timer);
      timer = null;
      totalTime = 0;
    }

    renderTimeAt(totalTime, '#timer');
  }

  function pauseTimer() {
    if (timer) {
      clearInterval(timer);
      timer = null;
    }
  }

  function stopTimer() {
    pauseTimer();
    calculateTotalTime();
    renderTimeAt(totalTime, '#timer');
  }

  function increaseWorkoutTime() {
    adjustWorkoutTime(incrementTime);
  }

  function decreaseWorkoutTime() {
    adjustWorkoutTime(-incrementTime);
  }

  function adjustWorkoutTime(adjustmentInSeconds) {
    let newTime = workoutTime + adjustmentInSeconds;
    if (newTime < 0) {
      newTime = 0
    }

    workoutTime = newTime;
    calculateTotalTime();
    renderTimeAt(workoutTime, '#workout-time');
    renderTimeAt(totalTime, '#timer');
  }

  function increaseRestTime() {
    adjustRestTime(incrementTime);
  }

  function decreaseRestTime() {
    adjustRestTime(-incrementTime);
  }

  function adjustRestTime(adjustmentInSeconds) {
    let newTime = restTime + adjustmentInSeconds;
    if (newTime < 0) {
      newTime = 0
    }

    restTime = newTime;
    calculateTotalTime();
    renderTimeAt(restTime, '#rest-time');
    renderTimeAt(totalTime, '#timer');
  }

  function calculateTotalTime() {
    const workoutTimePerRepetition = workoutsNumber * workoutTime;
    const restTimePerRepetition = ( workoutsNumber - 1 ) * restTime;
    totalTime = repetitionsNumber * (workoutTimePerRepetition + restTimePerRepetition);
  }

  function increaseWorkoutsNumber() {
    workoutsNumber += 1;
    calculateTotalTime();
    renderWorkoutsNumber(workoutsNumber);
    renderTimeAt(totalTime, '#timer');
  }

  function decreaseWorkoutsNumber() {
    let newWorkoutsNumber = workoutsNumber - 1;
    if (newWorkoutsNumber < 0) {
      newWorkoutsNumber = 0
    }
    workoutsNumber = newWorkoutsNumber;
    calculateTotalTime();
    renderWorkoutsNumber(workoutsNumber);
    renderTimeAt(totalTime, '#timer');
  }

  function increaseRepetitionsNumber() {
    repetitionsNumber += 1;
    calculateTotalTime();
    renderRepetitionsNumber(repetitionsNumber);
    renderTimeAt(totalTime, '#timer');
  }

  function decreaseRepetitionsNumber() {
    let newRepetitionsNumber = repetitionsNumber - 1;
    if (newRepetitionsNumber < 0) {
      newRepetitionsNumber = 0
    }
    repetitionsNumber = newRepetitionsNumber;
    calculateTotalTime();
    renderRepetitionsNumber(repetitionsNumber);
    renderTimeAt(totalTime, '#timer');
  }

  function renderTimeAt(timeInSeconds, selector) {
    const {minutes, seconds} = getMinutesAndSecondsFromTotalSeconds(timeInSeconds);
    document.querySelector(selector).innerHTML = stringifyMinutesAndSeconds(minutes, seconds);
  }

  function renderWorkoutsNumber(value) {
    document.querySelector('#workouts-number').innerHTML = value.toString();
  }

  function renderRepetitionsNumber(value) {
    document.querySelector('#repetitions-number').innerHTML = value.toString();
  }

  function getMinutesAndSecondsFromTotalSeconds(totalSeconds) {
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = Math.ceil(totalSeconds % 60) % 60;

    return {minutes, seconds}
  }

  function stringifyMinutesAndSeconds(minutes, seconds) {
    const minutesString = minutes < 10 ? '0' + minutes.toString() : minutes.toString();
    const secondsString = seconds < 10 ? '0' + seconds.toString() : seconds.toString();

    return minutesString + ':' + secondsString;
  }

  function registerEvents() {
    document.querySelector('#start-timer').addEventListener('click', startTimer);
    document.querySelector('#pause-timer').addEventListener('click', pauseTimer);
    document.querySelector('#stop-timer').addEventListener('click', stopTimer);
    document.querySelector('#increase-workout-time').addEventListener('click', increaseWorkoutTime);
    document.querySelector('#decrease-workout-time').addEventListener('click', decreaseWorkoutTime);
    document.querySelector('#increase-rest-time').addEventListener('click', increaseRestTime);
    document.querySelector('#decrease-rest-time').addEventListener('click', decreaseRestTime);
    document.querySelector('#increase-workouts-number').addEventListener('click', increaseWorkoutsNumber);
    document.querySelector('#decrease-workouts-number').addEventListener('click', decreaseWorkoutsNumber);
    document.querySelector('#increase-repetitions-number').addEventListener('click', increaseRepetitionsNumber);
    document.querySelector('#decrease-repetitions-number').addEventListener('click', decreaseRepetitionsNumber);
  }

  window.addEventListener('load', () => {
    registerEvents();
    renderTimeAt(defaultTotalTime, '#timer');
    renderTimeAt(defaultWorkoutTime, '#workout-time');
    renderTimeAt(defaultRestTime, '#rest-time');
    renderWorkoutsNumber(defaultWorkoutsNumber);
    renderRepetitionsNumber(defaultRepetitionsNumber);
  });
</script>
</body>
</html>