<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chronos</title>
</head>
<body>
<header>
  <h1>Chronos</h1>
</header>
<section>
  <div>
    <label>Timer: </label>
    <span id="timer"></span>
    <button id="start-timer">Start</button>
    <button id="pause-timer">Pause</button>
    <button id="stop-timer">Stop</button>
  </div>
  <div>
    <label>Workout Time: </label>
    <span id="workout-time"></span>
    <button id="increase-workout-time" class="time-adjustment">+ 5s</button>
    <button id="decrease-workout-time" class="time-adjustment">- 5s</button>
  </div>
  <div>
    <label>Rest Time: </label>
    <span id="rest-time"></span>
    <button id="increase-rest-time" class="time-adjustment">+ 5s</button>
    <button id="decrease-rest-time" class="time-adjustment">- 5s</button>
  </div>
</section>
<script>
  // time unit is seconds by default
  const defaultWorkoutTime = 30;
  const defaultRestTime = 10;
  const defaultTotalTime = defaultWorkoutTime + defaultRestTime;
  const incrementTime = 5;
  let workoutTime = defaultWorkoutTime;
  let restTime = defaultRestTime;
  let totalTime = defaultTotalTime;
  let timer = null;

  function startTimer() {
    if (!timer) {
      const end = Date.now() + totalTime * 1000;
      timer = setInterval(countdown, 1000, end);
      renderTimeAt(totalTime, '#timer');
    }
  }

  function countdown(endTimePoint) {
    const now = Date.now();
    totalTime = (endTimePoint - now) / 1000;

    if (totalTime <= 0) {
      clearInterval(timer);
      timer = null;
      totalTime = 0;
    }

    renderTimeAt(totalTime, '#timer');
  }

  function pauseTimer() {
    if (timer) {
      clearInterval(timer);
      timer = null;
    }
  }

  function stopTimer() {
    pauseTimer();
    calculateTotalTime();
    renderTimeAt(totalTime, '#timer');
  }

  function increaseWorkoutTime() {
    adjustWorkoutTime(incrementTime);
  }

  function decreaseWorkoutTime() {
    adjustWorkoutTime(-incrementTime);
  }

  function adjustWorkoutTime(adjustmentInSeconds) {
    let newTime = workoutTime + adjustmentInSeconds;
    if (newTime < 0) {
      newTime = 0
    }

    workoutTime = newTime;
    calculateTotalTime();
    renderTimeAt(workoutTime, '#workout-time');
    renderTimeAt(totalTime, '#timer');
  }

  function increaseRestTime() {
    adjustRestTime(incrementTime);
  }

  function decreaseRestTime() {
    adjustRestTime(-incrementTime);
  }

  function adjustRestTime(adjustmentInSeconds) {
    let newTime = restTime + adjustmentInSeconds;
    if (newTime < 0) {
      newTime = 0
    }

    restTime = newTime;
    calculateTotalTime();
    renderTimeAt(restTime, '#rest-time');
    renderTimeAt(totalTime, '#timer');
  }

  function calculateTotalTime() {
    totalTime = workoutTime + restTime;
  }

  function renderTimeAt(timeInSeconds, selector) {
    const {minutes, seconds} = getMinutesAndSecondsFromTotalSeconds(timeInSeconds);
    document.querySelector(selector).innerHTML = stringifyMinutesAndSeconds(minutes, seconds);
  }

  function getMinutesAndSecondsFromTotalSeconds(totalSeconds) {
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = Math.ceil(totalSeconds % 60) % 60;

    return {minutes, seconds}
  }

  function stringifyMinutesAndSeconds(minutes, seconds) {
    const minutesString = minutes < 10 ? '0' + minutes.toString() : minutes.toString();
    const secondsString = seconds < 10 ? '0' + seconds.toString() : seconds.toString();

    return minutesString + ':' + secondsString;
  }

  function registerEvents() {
    document.querySelector('#start-timer').addEventListener('click', startTimer);
    document.querySelector('#pause-timer').addEventListener('click', pauseTimer);
    document.querySelector('#stop-timer').addEventListener('click', stopTimer);
    document.querySelector('#increase-workout-time').addEventListener('click', increaseWorkoutTime);
    document.querySelector('#decrease-workout-time').addEventListener('click', decreaseWorkoutTime);
    document.querySelector('#increase-rest-time').addEventListener('click', increaseRestTime);
    document.querySelector('#decrease-rest-time').addEventListener('click', decreaseRestTime);
  }

  window.addEventListener('load', () => {
    registerEvents();
    renderTimeAt(defaultTotalTime, '#timer');
    renderTimeAt(defaultWorkoutTime, '#workout-time');
    renderTimeAt(defaultRestTime, '#rest-time');
  });
</script>
</body>
</html>