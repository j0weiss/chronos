<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chronos</title>
</head>
<body>
<header>
  <h1>Chronos</h1>
</header>
<section>
  <div id="timer"></div>
  <button id="start-timer">Start</button>
  <button id="pause-timer">Pause</button>
  <button id="stop-timer">Stop</button>
  <button id="increase-timer">+ 15s</button>
  <button id="decrease-timer">- 15s</button>
</section>
<script>
const defaultTimerMilliseconds = 3*60*1000;
let timerMilliseconds = defaultTimerMilliseconds;
let timer = null;

function increaseTimer() {
  adjustTimer(15000);
}

function decreaseTimer() {
  adjustTimer(-15000);
}

function adjustTimer(adjustmentInMilliseconds) {
  if (timer) {
    pauseTimer();
  }

  timerMilliseconds = timerMilliseconds + adjustmentInMilliseconds;
  renderRemainingTime(timerMilliseconds);

  if (timer) {
    timer = null;
    startTimer();
  }
}

function startTimer() {
  if (!timer) {
    const end = Date.now() + timerMilliseconds;
    timer = setInterval(countdown, 1000, end);
    renderRemainingTime(timerMilliseconds);
  }
}

function pauseTimer() {
  if (timer) {
    clearInterval(timer);
  }
}

function stopTimer() {
  if (timer) {
    clearInterval(timer);
    timer = null;
    timerMilliseconds = defaultTimerMilliseconds;
    renderRemainingTime(timerMilliseconds);
  }
}

function countdown(endTimePoint) {
  const now = Date.now();
  const remainingMilliseconds = endTimePoint - now;
  renderRemainingTime(remainingMilliseconds);
  timerMilliseconds = remainingMilliseconds;
}

function renderRemainingTime(milliseconds) {
  const minutes = Math.floor(( milliseconds / 1000 ) / 60);
  const seconds = Math.ceil(( milliseconds / 1000 ) % 60) % 60;

  const minutesString = minutes < 10 ? '0' + minutes : minutes;
  const secondsString = seconds < 10 ? '0' + seconds : seconds;

  document.querySelector('#timer').innerHTML = minutesString + ':' + secondsString;
}

function registerEvents() {
  document.querySelector('#start-timer').addEventListener('click', startTimer);
  document.querySelector('#pause-timer').addEventListener('click', pauseTimer);
  document.querySelector('#stop-timer').addEventListener('click', stopTimer);
  document.querySelector('#increase-timer').addEventListener('click', increaseTimer);
  document.querySelector('#decrease-timer').addEventListener('click', decreaseTimer);
}

window.addEventListener('load', () => {
  registerEvents();
  renderRemainingTime(timerMilliseconds);
});
</script>
</body>
</html>